<div class="modal fade" id="searchFoodModal" tabindex="-1" aria-hidden="true">
  <div class="modal-dialog modal-xl modal-dialog-centered">
    <div class="modal-content rounded-4">
      <div class="modal-header border-0 pb-0">
        <h5 class="modal-title">üîç Buscar alimento o receta</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Cerrar"></button>
      </div>

      <div class="modal-body pt-1">
        <div class="d-flex justify-content-between align-items-center mb-3">
          <div class="btn-group">
            <button class="btn btn-outline-primary" [class.active]="mode === 'food'" (click)="mode = 'food'; onSearchChange()">Alimentos</button>
            <button class="btn btn-outline-primary" [class.active]="mode === 'recipe'" (click)="mode = 'recipe'; onSearchChange()">Recetas</button>
          </div>

          <input type="number" class="form-control w-auto" [(ngModel)]="quantity" min="1" step="1"
                 style="max-width: 140px;" placeholder="Cantidad (g)">
        </div>

        <input type="text" class="form-control mb-4" placeholder="Escribe un alimento o receta..."
               [(ngModel)]="query" (ngModelChange)="onSearchChange()">

        <div class="list-group">
          @for (item of (mode === 'food' ? mergedResults : recipeResults); track item.name + '-' + item.imageUrl) {
            <div class="list-group-item list-group-item-action d-flex align-items-center gap-3 px-3 py-2 rounded-3 shadow-sm mb-3">
              <img [src]="item.imageUrl || 'assets/img/no-image-food.png'"
                   (error)="item.imageUrl = 'assets/img/no-image-food.png'"
                   class="rounded-3 flex-shrink-0"
                   style="width: 80px; height: 80px; object-fit: cover;"
                   alt="Imagen">

              <div class="flex-grow-1">
                <h6 class="mb-1">{{ item.name }}</h6>
                <div class="d-flex flex-wrap gap-2 mt-2">
                  <span class="badge bg-light text-dark border">üî• Calor√≠as: {{ item.calories || 0 }} kcal</span>
                  <span class="badge bg-light text-dark border">ü•© Prote√≠nas: {{ item.protein || 0 }} g</span>
                  <span class="badge bg-light text-dark border">üçû Carbohidratos: {{ item.carbs || 0 }} g</span>
                  <span class="badge bg-light text-dark border">üßà Grasas: {{ item.fat || 0 }} g</span>
                </div>
              </div>

              <button class="btn btn-outline-primary btn-sm ms-auto" (click)="selectItem(item)">A√±adir</button>
            </div>
          }
        </div>

        @if (loadingExternal) {
          <div class="text-center text-muted mb-3">
            <div class="spinner-border spinner-border-sm text-primary me-2"></div>
            Buscando m√°s resultados...
          </div>
        }

        @if (mode === 'food' && mergedResults.length === 0 && !loadingExternal) {
          <div class="text-center text-muted">No se encontraron alimentos.</div>
        }

        @if (mode === 'recipe' && recipeResults.length === 0) {
          <div class="text-center text-muted">No se encontraron recetas.</div>
        }
      </div>
    </div>
  </div>
</div>
